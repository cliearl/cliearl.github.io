<!DOCTYPE html>
<html lang="en-us">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='이번 포스팅에서는 코루틴을 사용해서 로또번호의 당첨을 확인하는 법에 대해 알아보도록 하겠습니다.
당첨번호 조회하기 이전에 로또번호 생성기 만들기강의에서 로또번호를 생성하는 앱을 만들어보았는데요, 여기서는 이 앱에 코루틴을 이용해서 당첨여부를 확인하는 기능을 추가하도록 하겠습니다. 코루틴에 대한 이론설명은 알기쉬운 코루틴 이론 강의를 참조하시기 바랍니다.
금주의 로또 당첨번호는 동행복권 홈페이지에서 확인할 수 있습니다. 다른 회차의 당첨번호는 홈페이지의 회차별 당첨번호 페이지에서 확인할 수 있게 되어 있습니다.
그런데 이렇게 홈페이지에 접속하지 않고도 당첨번호는 API로 조회할 수 있습니다. 다음 주소의 &amp;ldquo;회차&amp;quot;라고 되어 있는 부분에 확인하고 싶은 회차의 숫자를 넣으시면 됩니다.'><title>코루틴으로 로또번호 당첨 확인하기</title>

<link rel='canonical' href='https://cliearl.github.io/posts/android/lotto-checker/'>

<link rel="stylesheet" href="/scss/style.min.css"><meta property='og:title' content='코루틴으로 로또번호 당첨 확인하기'>
<meta property='og:description' content='이번 포스팅에서는 코루틴을 사용해서 로또번호의 당첨을 확인하는 법에 대해 알아보도록 하겠습니다.
당첨번호 조회하기 이전에 로또번호 생성기 만들기강의에서 로또번호를 생성하는 앱을 만들어보았는데요, 여기서는 이 앱에 코루틴을 이용해서 당첨여부를 확인하는 기능을 추가하도록 하겠습니다. 코루틴에 대한 이론설명은 알기쉬운 코루틴 이론 강의를 참조하시기 바랍니다.
금주의 로또 당첨번호는 동행복권 홈페이지에서 확인할 수 있습니다. 다른 회차의 당첨번호는 홈페이지의 회차별 당첨번호 페이지에서 확인할 수 있게 되어 있습니다.
그런데 이렇게 홈페이지에 접속하지 않고도 당첨번호는 API로 조회할 수 있습니다. 다음 주소의 &amp;ldquo;회차&amp;quot;라고 되어 있는 부분에 확인하고 싶은 회차의 숫자를 넣으시면 됩니다.'>
<meta property='og:url' content='https://cliearl.github.io/posts/android/lotto-checker/'>
<meta property='og:site_name' content='냉동코더의 기술블로그'>
<meta property='og:type' content='article'><meta property='article:section' content='Posts' /><meta property='article:tag' content='coroutine' /><meta property='article:tag' content='lotto' /><meta property='article:published_time' content='2021-07-17T16:01:01&#43;09:00'/><meta property='article:modified_time' content='2021-07-17T16:01:01&#43;09:00'/>
<meta name="twitter:title" content="코루틴으로 로또번호 당첨 확인하기">
<meta name="twitter:description" content="이번 포스팅에서는 코루틴을 사용해서 로또번호의 당첨을 확인하는 법에 대해 알아보도록 하겠습니다.
당첨번호 조회하기 이전에 로또번호 생성기 만들기강의에서 로또번호를 생성하는 앱을 만들어보았는데요, 여기서는 이 앱에 코루틴을 이용해서 당첨여부를 확인하는 기능을 추가하도록 하겠습니다. 코루틴에 대한 이론설명은 알기쉬운 코루틴 이론 강의를 참조하시기 바랍니다.
금주의 로또 당첨번호는 동행복권 홈페이지에서 확인할 수 있습니다. 다른 회차의 당첨번호는 홈페이지의 회차별 당첨번호 페이지에서 확인할 수 있게 되어 있습니다.
그런데 이렇게 홈페이지에 접속하지 않고도 당첨번호는 API로 조회할 수 있습니다. 다음 주소의 &amp;ldquo;회차&amp;quot;라고 되어 있는 부분에 확인하고 싶은 회차의 숫자를 넣으시면 됩니다.">
    <link rel="shortcut icon" href="favicon/favicon.ico" />

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-769063-3', 'auto');
	
	ga('send', 'pageview');
}
</script>
    </head>
    <body class="
    article-page has-toc
">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "dark");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex 
    
        extended
    
">
    
        <div id="article-toolbar">
            <a href="https://cliearl.github.io" class="back-home">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="15 6 9 12 15 18" />
</svg>



                <span>Back</span>
            </a>
        </div>
    
<main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/android/" >
                android
            </a>
        
    </header>
    

    <h2 class="article-title">
        <a href="/posts/android/lotto-checker/">코루틴으로 로또번호 당첨 확인하기</a>
    </h2>

    

    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Jul 17, 2021</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    4 minute read
                </time>
            </div>
        
    </footer>
    
</div>
</header>

    <section class="article-content">
    <p>이번 포스팅에서는 코루틴을 사용해서 로또번호의 당첨을 확인하는 법에 대해 알아보도록 하겠습니다.</p>
<h2 id="당첨번호-조회하기">당첨번호 조회하기</h2>
<p>이전에 <a class="link" href="https://cliearl.github.io/posts/android/lotto-generator/"  target="_blank" rel="noopener"
    >로또번호 생성기 만들기</a>강의에서 로또번호를 생성하는 앱을 만들어보았는데요, 여기서는 이 앱에 코루틴을 이용해서 당첨여부를 확인하는 기능을 추가하도록 하겠습니다. 코루틴에 대한 이론설명은 <a class="link" href="https://cliearl.github.io/posts/android/coroutine-principle/"  target="_blank" rel="noopener"
    >알기쉬운 코루틴 이론</a> 강의를 참조하시기 바랍니다.</p>
<p>금주의 로또 당첨번호는 <a class="link" href="https://dhlottery.co.kr/common.do?method=main"  target="_blank" rel="noopener"
    >동행복권 홈페이지</a>에서 확인할 수 있습니다. 다른 회차의 당첨번호는 홈페이지의 <a class="link" href="https://dhlottery.co.kr/gameResult.do?method=byWin&amp;wiselog=C_A_1_2"  target="_blank" rel="noopener"
    >회차별 당첨번호 페이지</a>에서 확인할 수 있게 되어 있습니다.</p>
<p>그런데 이렇게 홈페이지에 접속하지 않고도 당첨번호는 API로 조회할 수 있습니다. 다음 주소의 &ldquo;회차&quot;라고 되어 있는 부분에 확인하고 싶은 회차의 숫자를 넣으시면 됩니다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html">https://dhlottery.co.kr/common.do?method=getLottoNumber<span class="err">&amp;</span>drwNo=&#34;회차&#34;
</code></pre></div><p>예를 들면 968회차의 응답은 다음과 같은 json 형식으로 돌아옵니다. totSellamnt는 총 판매액, returnValue는 API응답 성공여부, drwNoDate는 추첨일, firstWinamnt는 1등상금, drwNo는 회차, drwtNo1~6이 당첨번호이고, bnusNo가 보너스번호입니다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span><span class="nt">&#34;totSellamnt&#34;</span><span class="p">:</span><span class="mi">95924229000</span><span class="p">,</span><span class="nt">&#34;returnValue&#34;</span><span class="p">:</span><span class="s2">&#34;success&#34;</span><span class="p">,</span><span class="nt">&#34;drwNoDate&#34;</span><span class="p">:</span><span class="s2">&#34;2021-06-19&#34;</span><span class="p">,</span><span class="nt">&#34;firstWinamnt&#34;</span><span class="p">:</span><span class="mi">1667729683</span><span class="p">,</span><span class="nt">&#34;drwtNo6&#34;</span><span class="p">:</span><span class="mi">39</span><span class="p">,</span><span class="nt">&#34;drwtNo4&#34;</span><span class="p">:</span><span class="mi">14</span><span class="p">,</span><span class="nt">&#34;firstPrzwnerCo&#34;</span><span class="p">:</span><span class="mi">13</span><span class="p">,</span><span class="nt">&#34;drwtNo5&#34;</span><span class="p">:</span><span class="mi">24</span><span class="p">,</span><span class="nt">&#34;bnusNo&#34;</span><span class="p">:</span><span class="mi">33</span><span class="p">,</span><span class="nt">&#34;firstAccumamnt&#34;</span><span class="p">:</span><span class="mi">21680485879</span><span class="p">,</span><span class="nt">&#34;drwNo&#34;</span><span class="p">:</span><span class="mi">968</span><span class="p">,</span><span class="nt">&#34;drwtNo2&#34;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span><span class="nt">&#34;drwtNo3&#34;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="nt">&#34;drwtNo1&#34;</span><span class="p">:</span><span class="mi">2</span><span class="p">}</span>
</code></pre></div><h2 id="dependency-확인">Dependency 확인</h2>
<p>자 그러면 drwtNo1~6, bnusNo의 값을 추출해서 나의 값과 비교하면 되겠네요. 당첨번호는 네트워크에서 백그라운드로 받아와야 하기 때문에 코루틴으로 처리하도록 하면 되겠고, 받아온 json으로부터 값을 추출하는데에는 gson 라이브러리를 사용하면 될 것 같습니다. gson의 사용법에 대해서는 <a class="link" href="https://cliearl.github.io/posts/android/sharedpreferneces-gson/"  target="_blank" rel="noopener"
    >SharedPreferences를 json 포맷으로 관리하기</a> 강의에서 다루었으니 그것을 참고하시면 되겠습니다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="n">implementation</span> <span class="err">&#39;</span><span class="n">org</span><span class="p">.</span><span class="n">jetbrains</span><span class="p">.</span><span class="n">kotlinx</span><span class="p">:</span><span class="n">kotlinx</span><span class="p">-</span><span class="n">coroutines</span><span class="p">-</span><span class="n">android</span><span class="p">:</span><span class="m">1.4</span><span class="p">.</span><span class="m">1</span><span class="err">&#39;</span>
<span class="n">implementation</span> <span class="err">&#39;</span><span class="n">com</span><span class="p">.</span><span class="n">google</span><span class="p">.</span><span class="n">code</span><span class="p">.</span><span class="n">gson</span><span class="p">:</span><span class="n">gson</span><span class="p">:</span><span class="m">2.8</span><span class="p">.</span><span class="m">6</span><span class="err">&#39;</span>
</code></pre></div><h2 id="네트워크로-당첨번호-받아오기">네트워크로 당첨번호 받아오기</h2>
<p>그럼 네트워크로 당첨번호를 받아오는 getLottoNumbers 함수와, 두 값을 비교하는 whatIsRank 함수를 만들도록 하겠습니다.</p>
<p>getLottoNumbers는 전달받은 API 주소에 조회를 요청하고 반환값을 처리합니다. 이 함수는 네트워크를 사용해야 하므로 코루틴 안에서 사용하기 위해 suspend 키워드를 붙여줍니다. API는 단순한 GET 요청이므로 소켓을 만들지 않고 간단하게 <a class="link" href="https://kotlinlang.org/api/latest/jvm/stdlib/org.w3c.dom.url/-u-r-l/"  target="_blank" rel="noopener"
    >URL</a>과 <a class="link" href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.io/java.net.-u-r-l/read-text.html"  target="_blank" rel="noopener"
    >readText</a>로 값을 읽어오도록 하였습니다.</p>
<p>API 주소와 결합할 round에는 내 번호와 비교할 당첨번호의 회차를 넣습니다. 읽어온 값의 returnValue가 success이면 drwtNo1~6, bnusNo 값을 추출하여 배열에 모으도록 하였습니다. 마지막에는 당첨번호를 확인할 회차를 추가하였습니다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="k">private</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">getLottoNumbers</span><span class="p">():</span> <span class="n">ArrayList</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="k">val</span> <span class="py">round</span> <span class="p">=</span> <span class="s2">&#34;968&#34;</span>
    <span class="k">val</span> <span class="py">url</span> <span class="p">=</span> <span class="s2">&#34;https://dhlottery.co.kr/common.do?method=getLottoNumber&amp;drwNo=</span><span class="si">$round</span><span class="s2">&#34;</span>

    <span class="k">val</span> <span class="py">lottoNumbers</span> <span class="p">=</span> <span class="n">ArrayList</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">&gt;()</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="k">val</span> <span class="py">response</span> <span class="p">=</span> <span class="n">URL</span><span class="p">(</span><span class="n">url</span><span class="p">).</span><span class="n">readText</span><span class="p">()</span>
        <span class="k">val</span> <span class="py">jsonObject</span> <span class="p">=</span> <span class="n">JsonParser</span><span class="p">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">response</span><span class="p">).</span><span class="n">asJsonObject</span>
        <span class="k">val</span> <span class="py">returnValue</span> <span class="p">=</span> <span class="n">jsonObject</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s2">&#34;returnValue&#34;</span><span class="p">).</span><span class="n">asString</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">returnValue</span> <span class="o">==</span> <span class="s2">&#34;success&#34;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="m">1.</span><span class="p">.</span><span class="m">6</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">val</span> <span class="py">lottoNumber</span> <span class="p">=</span> <span class="n">jsonObject</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s2">&#34;drwtNo</span><span class="si">$i</span><span class="s2">&#34;</span><span class="p">).</span><span class="n">asInt</span>
                <span class="n">lottoNumbers</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">lottoNumber</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="k">val</span> <span class="py">bonusNumber</span> <span class="p">=</span> <span class="n">jsonObject</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s2">&#34;bnusNo&#34;</span><span class="p">).</span><span class="n">asInt</span>
            <span class="n">lottoNumbers</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">bonusNumber</span><span class="p">)</span>
            <span class="n">lottoNumbers</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">round</span><span class="p">.</span><span class="n">toInt</span><span class="p">())</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="n">Exception</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">e</span><span class="p">.</span><span class="n">printStackTrace</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">lottoNumbers</span>
<span class="p">}</span>
</code></pre></div><h2 id="내-번호와-당첨번호-비교하기">내 번호와 당첨번호 비교하기</h2>
<p>다음은 내 번호와 당첨번호를 비교하는 함수를 만듭니다. 로또의 규칙은 표의 내용과 같이 되어 있습니다. 그래서 whatIsRank에서는 내 로또번호와 당첨번호를 전달받아 처음 6개까지의 숫자를 비교해 일치한 갯수를 세고, 일치한 번호의 갯수가 5개이면 추가로 보너스번호인 7번째 번호가 일치하는지 확인하도록 하면 됩니다.</p>
<table>
<thead>
<tr>
<th style="text-align:center">순위</th>
<th style="text-align:center">당첨내용</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">6개 번호 모두 일치</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">5개 번호 일치 + 나머지 1개가 보너스 번호와 일치</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">5개 번호 일치</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">4개 번호 일치</td>
</tr>
<tr>
<td style="text-align:center">5</td>
<td style="text-align:center">3개 번호 일치</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="k">private</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">whatIsRank</span><span class="p">(</span><span class="n">lottoNumbers</span><span class="p">:</span> <span class="n">ArrayList</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">&gt;,</span> <span class="n">winningNumbers</span><span class="p">:</span> <span class="n">ArrayList</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">&gt;):</span> <span class="n">String</span> <span class="p">{</span>
    <span class="c1">// https://namu.wiki/w/%EB%A1%9C%EB%98%90%206/45#s-4
</span><span class="c1"></span>    <span class="k">var</span> <span class="py">matchCount</span> <span class="p">=</span> <span class="m">0</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="m">0.</span><span class="p">.</span><span class="m">5</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lottoNumbers</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="n">winningNumbers</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="p">{</span>
            <span class="n">matchCount</span> <span class="o">+=</span> <span class="m">1</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">if</span> <span class="p">(</span><span class="n">matchCount</span> <span class="o">==</span> <span class="m">6</span><span class="p">)</span> <span class="p">{</span>
        <span class="s2">&#34;1등&#34;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">matchCount</span> <span class="o">==</span> <span class="m">5</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lottoNumbers</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="n">winningNumbers</span><span class="p">[</span><span class="m">6</span><span class="p">]))</span> <span class="p">{</span>
            <span class="s2">&#34;2등&#34;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="s2">&#34;3등&#34;</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">matchCount</span> <span class="o">==</span> <span class="m">4</span><span class="p">)</span> <span class="p">{</span>
        <span class="s2">&#34;4등&#34;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">matchCount</span> <span class="o">==</span> <span class="m">3</span><span class="p">)</span> <span class="p">{</span>
        <span class="s2">&#34;5등&#34;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="s2">&#34;낙첨&#34;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>xml에는 비교결과를 보여주는 텍스트뷰 하나를 추가하도록 하겠습니다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;TextView</span>
    <span class="na">android:id=</span><span class="s">&#34;@+id/tv_winning&#34;</span>
    <span class="na">android:layout_width=</span><span class="s">&#34;match_parent&#34;</span>
    <span class="na">android:layout_height=</span><span class="s">&#34;wrap_content&#34;</span>
    <span class="na">android:layout_marginTop=</span><span class="s">&#34;20dp&#34;</span>
    <span class="na">android:gravity=</span><span class="s">&#34;center&#34;</span>
    <span class="na">android:text=</span><span class="s">&#34;당첨결과&#34;</span>
    <span class="na">android:textAppearance=</span><span class="s">&#34;@style/TextAppearance.AppCompat.Large&#34;</span> <span class="nt">/&gt;</span>
</code></pre></div><h2 id="코루틴으로-작업-처리하기">코루틴으로 작업 처리하기</h2>
<p>그러면 번호생성버튼을 눌렀을 때 생성된 번호를 당첨번호와 비교하는 코루틴을 추가하겠습니다. CoroutineScope로 스코프를 정의하고, 네트워크에서 값을 가져올 것이기 때문에 Dispatchers는 IO로 설정합니다. 그리고 작업 후에 값을 반환할 필요가 없기 때문에 빌더는 launch를 사용합니다.</p>
<p>작업은 getLottoNumbers에서 얻어진 결과값를 whatIsRank에 사용해야 하기 때문에 winningNumbers는 async로 자식 코루틴을 만듭니다. whatIsRank에 전달할때는 Deferred 반환값을 끝까지 처리하여 ArrayList를 전해주기 위해 await를 사용합니다. 최종적으로 텍스트뷰에 표시할 텍스트를 만들때도 await를 사용해서 처리가 모두 종료될 때까지 기다리도록 합니다.</p>
<p>마지막으로 text를 텍스트뷰에 표시해야 하는데 이 부분은 UI를 건드리는 부분이라 메인스레드에서 작업이 이루어져야 하기 때문에 작업할 스레드를 withContext로 전환한 뒤 당첨결과를 표시하면 되겠죠.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="n">binding</span><span class="p">.</span><span class="n">generateButton</span><span class="p">.</span><span class="n">setOnClickListener</span> <span class="p">{</span>
    <span class="k">val</span> <span class="py">lottoNumbers</span> <span class="p">=</span> <span class="n">createLottoNumbers</span><span class="p">()</span>
    <span class="n">Log</span><span class="p">.</span><span class="n">d</span><span class="p">(</span><span class="s2">&#34;TAG&#34;</span><span class="p">,</span> <span class="n">lottoNumbers</span><span class="p">.</span><span class="n">toString</span><span class="p">())</span>
    <span class="n">updateLottoBallImage</span><span class="p">(</span><span class="n">lottoNumbers</span><span class="p">)</span>

    <span class="n">CoroutineScope</span><span class="p">(</span><span class="n">Dispatchers</span><span class="p">.</span><span class="n">IO</span> <span class="p">+</span> <span class="n">job</span><span class="p">).</span><span class="n">launch</span> <span class="p">{</span>
        <span class="k">val</span> <span class="py">winningNumbers</span> <span class="p">=</span> <span class="n">async</span> <span class="p">{</span> <span class="n">getLottoNumbers</span><span class="p">()</span> <span class="p">}</span>
        <span class="k">val</span> <span class="py">rank</span> <span class="p">=</span> <span class="n">whatIsRank</span><span class="p">(</span><span class="n">lottoNumbers</span><span class="p">,</span> <span class="n">winningNumbers</span><span class="p">.</span><span class="n">await</span><span class="p">())</span>
        <span class="k">val</span> <span class="py">text</span> <span class="p">=</span> <span class="s2">&#34;</span><span class="si">${winningNumbers.await()}</span><span class="s2"> : </span><span class="si">$rank</span><span class="s2">&#34;</span>

        <span class="n">withContext</span><span class="p">(</span><span class="n">Dispatchers</span><span class="p">.</span><span class="n">Main</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">binding</span><span class="p">.</span><span class="n">tvWinning</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="n">text</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h2 id="코루틴-취소하기">코루틴 취소하기</h2>
<p>액티비티가 종료되었을 때 실행중인 코루틴이 살아남는것을 방지하기 위해 취소하는 기능을 추가해 보도록 하겠습니다. <a class="link" href="https://cliearl.github.io/posts/android/coroutine-principle/"  target="_blank" rel="noopener"
    >알기쉬운 코루틴 이론</a> 강의에서 설명했던 것처럼 코루틴을 취소하기 위해서는 job에 대해 cancel을 수행하면 됩니다. 그런데 generateButton 안에서 수행된 CoroutineScope에 대해서는 반환되는 job을 오브젝트로 만들지 않았습니다.</p>
<p>이런 경우에는 Job 전역변수를 하나 만들어 주고 디스패처와 결합합니다. 코틀린의 코루틴은 자식 코루틴이 취소되면 연결된 부모 코루틴이 모두 취소되는 특징을 가지고 있으므로 onDestroy에서 job에 대해 cancel을 수행하면 연결시킨 코루틴을 취소할 수 있습니다.</p>
<p>실제 예제에서는 뷰모델을 이용하게 되므로 lifecycle 모듈과 결합하여 사용하면 좀 더 앱의 라이프사이클과 연동된 생명주기를 가지게 할 수 있습니다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="k">class</span> <span class="nc">MainActivity</span> <span class="p">:</span> <span class="n">AppCompatActivity</span><span class="p">()</span> <span class="p">{</span>
    <span class="o">..</span><span class="p">.</span>
    <span class="k">private</span> <span class="k">val</span> <span class="py">job</span> <span class="p">=</span> <span class="n">Job</span><span class="p">()</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">:</span> <span class="n">Bundle</span><span class="p">?)</span> <span class="p">{</span>
        <span class="o">..</span><span class="p">.</span>
        <span class="n">binding</span><span class="p">.</span><span class="n">generateButton</span><span class="p">.</span><span class="n">setOnClickListener</span> <span class="p">{</span>
            <span class="o">..</span><span class="p">.</span>
            <span class="n">CoroutineScope</span><span class="p">(</span><span class="n">Dispatchers</span><span class="p">.</span><span class="n">IO</span> <span class="p">+</span> <span class="n">job</span><span class="p">).</span><span class="n">launch</span> <span class="p">{</span>
                <span class="o">..</span><span class="p">.</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onDestroy</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">job</span><span class="p">.</span><span class="n">cancel</span><span class="p">()</span>
        <span class="k">super</span><span class="p">.</span><span class="n">onDestroy</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>이렇게 코루틴을 이용해서 나의 로또번호를 인터넷의 당첨결과와 비교하는 법에 대해 알아보았습니다.</p>
<div class="video-wrapper">
    <iframe loading="lazy" 
            src="https://www.youtube.com/embed/DjnzSvM7DG4" 
            allowfullscreen 
            title="YouTube Video"
    >
    </iframe>
</div>


</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/coroutine/">coroutine</a>
        
            <a href="/tags/lotto/">lotto</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY 4.0</span>
    </section>
    </footer>


    
</article>

    <aside class="related-contents--wrapper">
    
    
        <h2 class="section-title">Related contents</h2>
        <div class="related-contents">
            <div class="flex article-list--tile">
                
                    
<article class="">
    <a href="/posts/android/coroutine-principle/">
        
        

        <div class="article-details">
            <h2 class="article-title">알기쉬운 코루틴 이론</h2>
        </div>
    </a>
</article>
                
                    
<article class="">
    <a href="/posts/android/understanding-singleton-pattern/">
        
        

        <div class="article-details">
            <h2 class="article-title">알기쉬운 Singleton Pattern</h2>
        </div>
    </a>
</article>
                
                    
<article class="">
    <a href="/posts/android/android-gradle-java-11/">
        
        

        <div class="article-details">
            <h2 class="article-title">Android Studio Arctic Fox와 JDK 11의 도입</h2>
        </div>
    </a>
</article>
                
                    
<article class="">
    <a href="/posts/android/jsoup-lotto-checker/">
        
        

        <div class="article-details">
            <h2 class="article-title">jsoup으로 로또 홈페이지의 당첨번호 파싱하기</h2>
        </div>
    </a>
</article>
                
                    
<article class="">
    <a href="/posts/android/recyclerview-listadapter/">
        
        

        <div class="article-details">
            <h2 class="article-title">DiffUtil과 ListAdapter 이해하고 RecyclerView에 적용하기</h2>
        </div>
    </a>
</article>
                
            </div>
        </div>
    
</aside>

     
     
        
    <script src="https://utteranc.es/client.js" 
        repo="cliearl/cliearl.github.io"
        issue-term="cliearl"
        
        crossorigin="anonymous"
        async
        >
</script>

<style>
    .utterances {
        max-width: unset;
    }
</style>

<script>
    function setUtterancesTheme(theme) {
        let utterances = document.querySelector('.utterances iframe');
        if (utterances) {
            utterances.contentWindow.postMessage(
                {
                    type: 'set-theme',
                    theme: `github-${theme}`
                },
                'https://utteranc.es'
            );
        }
    }

    addEventListener('message', event => {
        if (event.origin !== 'https://utteranc.es') return;
        setUtterancesTheme(document.documentElement.dataset.scheme)
    });

    window.addEventListener('onColorSchemeChange', (e) => {
        setUtterancesTheme(e.detail)
    })
</script>


    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2021 냉동코더의 기술블로그
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.2.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer="true"
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer="true"
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >

            </main>
    
        <aside class="sidebar right-sidebar sticky">
            <section class="widget archives">
                <div class="widget-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



                </div>
                <h2 class="widget-title section-title">Table of contents</h2>
                
                <div class="widget--toc">
                    <nav id="TableOfContents">
  <ol>
    <li><a href="#당첨번호-조회하기">당첨번호 조회하기</a></li>
    <li><a href="#dependency-확인">Dependency 확인</a></li>
    <li><a href="#네트워크로-당첨번호-받아오기">네트워크로 당첨번호 받아오기</a></li>
    <li><a href="#내-번호와-당첨번호-비교하기">내 번호와 당첨번호 비교하기</a></li>
    <li><a href="#코루틴으로-작업-처리하기">코루틴으로 작업 처리하기</a></li>
    <li><a href="#코루틴-취소하기">코루틴 취소하기</a></li>
  </ol>
</nav>
                </div>
            </section>
        </aside>
    

        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                defer="false"
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
